<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASTEGNI - Tutor Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="css/root_theme.css" rel="stylesheet" />
  <style>
    body {
      background-color: var(--background);
      color: var(--text);
      font-family: sans-serif;
    }

    nav {
      background-color: var(--highlight);
    }

    nav a {
      color: var(--nav-link);
    }

    nav a:hover {
      color: var(--nav-link-hover);
    }

    button.cta-button {
      background-color: var(--button-bg);
      color: var(--button-text);
    }

    button.cta-button:hover {
      background-color: var(--button-hover);
    }

    footer {
      background-color: var(--footer-bg);
      color: var(--footer-text);
    }

    .modal-content {
      background-color: var(--modal-bg);
      color: var(--modal-text);
    }

    .progress-circle:hover .tooltip {
      display: block;
    }

    .tooltip {
      display: none;
      position: absolute;
      z-index: 10;
      background-color: var(--modal-bg);
      color: var(--modal-text);
      padding: 0.5rem;
      border-radius: 0.25rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    canvas {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }

    video.preview {
      max-height: 100px;
    }

    .ad-placeholder {
      background-color: var(--background);
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      font-weight: bold;
      margin-bottom: 1rem;
      text-align: center;
    }

    #cover-photo {
      height: 150px;
      background-size: cover;
      background-position: center;
      position: relative;
      border-radius: 8px;
    }

    #profile-picture {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      position: absolute;
      bottom: -40px;
      left: 20px;
      border: 4px solid var(--background);
      object-fit: cover;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="p-4 sticky top-0 z-10 shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold">ASTEGNI</a>
      <div class="hidden md:flex space-x-6 items-center" id="desktop-nav">
        <a href="index.html" class="hover:text-[var(--nav-link-hover)]">Home</a>
        <a href="find-tutors.html" class="hover:text-[var(--nav-link-hover)]">Find Students</a>
        <button id="notification-bell" class="relative focus:outline-none" onclick="openNotificationModal()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 00-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 01-6 0v-1m6 0H9"></path>
          </svg>
          <span id="notification-dot" class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full hidden"></span>
        </button>
        <button id="theme-toggle" class="cta-button px-4 py-2 rounded-lg">Toggle Theme</button>
      </div>
      <button id="menu-btn" class="md:hidden focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>
    </div>
    <div id="mobile-menu" class="hidden md:hidden bg-[var(--highlight)] mt-2 rounded-lg shadow">
      <a href="index.html" class="block py-2 px-4 hover:bg-[var(--button-hover)]">Home</a>
      <a href="find-tutors.html" class="block py-2 px-4 hover:bg-[var(--button-hover)]">Find Students</a>
      <button id="mobile-notification-bell" class="block py-2 px-4 hover:bg-[var(--button-hover)] w-full text-left relative" onclick="openNotificationModal()">
        Notifications
        <span id="mobile-notification-dot" class="absolute top-2 right-4 w-2 h-2 bg-red-500 rounded-full hidden"></span>
      </button>
      <button id="mobile-theme-toggle" class="cta-button block py-2 px-4 w-full text-left">Toggle Theme</button>
    </div>
  </nav>

  <!-- Tutor Profile Section -->
  <section class="py-16">
    <div class="container mx-auto px-4 flex flex-col lg:flex-row gap-8">
      <!-- Main Content (Tutor Profile) -->
      <div class="lg:w-3/4">
        <!-- Cover Photo -->
        <div id="cover-photo" class="mb-8" style="background-image: url('https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=150&q=80');">
          <img src="pictures/profile_picture.png" id="profile-picture" alt="Tutor Profile Picture">
        </div>
        <div class="p-6 bg-[var(--modal-bg)] rounded-lg shadow-lg">
          <div class="flex flex-col md:flex-row gap-4 mb-4">
            <div class="profile-details w-full md:w-2/3">
              <h2 id="tutor-name" class="text-2xl font-bold inline-flex items-center">
                Amanuel Tesfaye
                <span class="ml-2 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center" title="Verified Tutor">
                  <svg class="w-4 h-4" fill="white" viewBox="0 0 20 20">
                    <path d="M16.707 5.293a1 1 0 00-1.414 0L8 12.586l-3.293-3.293a1 1 0 00-1.414 1.414l4 4a1 1 0 001.414 0l8-8a1 1 0 000-1.414z"/>
                  </svg>
                </span>
              </h2>
              <p id="verification-status" class="text-sm italic mb-2"></p>
              <div class="flex flex-col items-start mb-4">
                <div class="relative w-16 h-16 progress-circle">
                  <svg class="w-full h-full" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                    <circle id="rating-arc" cx="50" cy="50" r="45" stroke="#EF4444" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283"/>
                  </svg>
                  <div class="absolute inset-0 flex items-center justify-center font-bold text-sm text-[var(--text)]" id="rating-label">N/A</div>
                </div>
                <span id="tutor-rating-stars" class="text-yellow-500 mt-1">No rating</span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                  <p class="text-[var(--text)]"><span id="follower-number">0</span> Followers</p>
                  <p id="tutor-gender" class="text-[var(--text)]">Male</p>
                </div>
                <div>
                  <p id="tutor-address" class="text-[var(--text)]">Address: Not set</p>
                  <p id="tutor-school" class="text-[var(--text)]">Teaches: Not set</p>
                </div>
                <div>
                  <p id="courses" class="text-[var(--text)]">Courses: Not set</p>
                  <p id="payment-method" class="text-[var(--text)]">Payment Method: Not set</p>
                </div>
              </div>
              <h4 class="text-2xl font-bold mb-4 text-[var(--heading)]">About me</h4>
              <p id="tutor-bio" class="text-[var(--text)]">Hi, I'm Amanuel, a passionate tutor with 5 years of experience in teaching Math and Physics. I focus on making complex concepts simple and engaging for students.</p>
              <h4 class="text-2xl font-bold mb-4 text-[var(--heading)]">Certifications</h4>
              <p id="tutor-certifications" class="text-[var(--text)]">BSc in Physics, Addis Ababa University, 2018<br>Teaching Certificate, Ethiopian Ministry of Education, 2019</p>
              <div class="mb-4">
                <h3 class="text-xl font-semibold mb-2" style="color: var(--heading);">Connect with me through:</h3>
                <div id="view-profile-socials" class="flex space-x-4">
                  <a id="social-facebook" href="#" target="_blank" class="hover:text-[var(--nav-link-hover)]">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.5 7.09h-2.07c-.28 0-.5.22-.5.5v1.41h2.57l-.34 2.59h-2.23v6.41h-2.59v-6.41H9.5v-2.59h1.84V9.59c0-1.81 1.1-2.8 2.71-2.8h1.95v2.3z"/></svg>
                  </a>
                  <a id="social-linkedin" href="#" target="_blank" class="hover:text-[var(--nav-link-hover)]">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2.5 16.5h-2v-7h2v7zm-1-7.9c-.7 0-1.2-.6-1.2-1.3s.5-1.3 1.2-1.3 1.2.6 1.2 1.3-.5 1.3-1.2 1.3zm9.5 7.9h-2v-4c0-.9-.3-1.5-1.1-1.5-.6 0-1 .4-1.1 1v4.5h-2v-7h2v1.1c.3-.5.9-.8 1.6-.8 1.2 0 2.1.7 2.1 2.2v4.5z"/></svg>
                  </a>
                  <a id="social-twitter" href="#" target="_blank" class="hover:text-[var(--nav-link-hover)]">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-wrap gap-2 mb-6">
            <button onclick="openEditProfileModal()" class="cta-button px-4 py-2 rounded-lg flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
              </svg>
              Edit Profile
            </button>
            <button onclick="openChatModal()" class="cta-button px-4 py-2 rounded-lg">Chat</button>
            <button onclick="openStudentsModal()" class="cta-button px-4 py-2 rounded-lg">My Students</button>
            <button onclick="openCommentModal()" class="cta-button px-4 py-2 rounded-lg">View Comments</button>
            <button onclick="openReferralModal()" class="cta-button px-4 py-2 rounded-lg">Share Referral</button>
          </div>
          <!-- Sponsorship Placeholder -->
          <div id="sponsorship-placeholder-2" class="rounded-lg shadow-lg p-4 text-center bg-[var(--highlight)]">
            <h3 class="text-xl font-semibold mb-2" style="color: var(--heading)">Sponsor Our Platform</h3>
            <img src="https://via.placeholder.com/728x90" class="mx-auto mb-4 rounded" alt="Sponsorship Placeholder">
            <p class="text-[var(--text)]">Interested in sponsoring ASTEGNI? Contact us at <a href="mailto:info@astegni.et" class="underline">info@astegni.et</a Sunspear!</p>
          </div>
          <!-- Introduction Video -->
          <div class="mt-8">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold text-[var(--heading)]">Introduction Video</h3>
              <button onclick="openUploadVideoModal()" class="cta-button px-4 py-2 rounded-lg">Upload Video</button>
            </div>
            <video controls class="w-full rounded-lg" id="intro-video">
              <source src="https://via.placeholder.com/640x360.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <p id="intro-video-desc" class="text-[var(--text)] mt-2">Introduction to my teaching style.</p>
            <div class="flex gap-2 mt-2">
              <button class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üëç Like</button>
              <button class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üëé Dislike</button>
              <button onclick="openVideoCommentModal('intro')" class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üí¨ Comment</button>
              <button onclick="openShareModal('intro')" class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">‚Üó Share</button>
            </div>
            <div id="intro-comments" class="text-[var(--text)] mt-2">
              <p>No comments yet.</p>
            </div>
            <button onclick="openVideoDescModal('intro')" class="cta-button px-4 py-2 rounded-lg mt-4">Video Description</button>
            <!-- Short Clips -->
            <h4 class="text-lg font-semibold mt-8 mb-4 text-[var(--heading)]">Short Clips</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <video controls class="w-full rounded-lg" id="clip-1">
                  <source src="https://via.placeholder.com/320x180.mp4" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
                <p id="clip-1-desc" class="text-[var(--text)] mt-2">Quick Math tip.</p>
                <div class="flex gap-2 mt-2">
                  <button class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üëç Like</button>
                  <button class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üëé Dislike</button>
                  <button onclick="openVideoCommentModal('clip1')" class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üí¨ Comment</button>
                  <button onclick="openShareModal('clip1')" class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">‚Üó Share</button>
                </div>
                <div id="clip1-comments" class="text-[var(--text)] mt-2">
                  <p>No comments yet.</p>
                </div>
                <button onclick="openVideoDescModal('clip1')" class="cta-button px-4 py-2 rounded-lg mt-4">Video Description</button>
              </div>
              <div>
                <video controls class="w-full rounded-lg" id="clip-2">
                  <source src="https://via.placeholder.com/320x180.mp4" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
                <p id="clip-2-desc" class="text-[var(--text)] mt-2">Physics concept explained.</p>
                <div class="flex gap-2 mt-2">
                  <button class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üëç Like</button>
                  <button class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üëé Dislike</button>
                  <button onclick="openVideoCommentModal('clip2')" class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">üí¨ Comment</button>
                  <button onclick="openShareModal('clip2')" class="px-2 py-1 rounded hover:bg-[var(--button-hover)]">‚Üó Share</button>
                </div>
                <div id="clip2-comments" class="text-[var(--text)] mt-2">
                  <p>No comments yet.</p>
                </div>
                <button onclick="openVideoDescModal('clip2')" class="cta-button px-4 py-2 rounded-lg mt-4">Video Description</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Advertisement Sidebar -->
      <aside class="lg:w-1/4 hidden lg:block sticky top-20 self-start">
        <div class="ad-placeholder" style="width: 300px; height: 250px;">Advertisement (300x250)</div>
        <div class="ad-placeholder" style="width: 300px; height: 250px;">Advertisement (300x250)</div>
        <div class="ad-placeholder" style="width: 300px; height: 250px;">Advertisement (300x250)</div>
      </aside>
    </div>
  </section>

  <!-- Modals -->
  <!-- Student Details Modal -->
  <div id="student-details-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-lg max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Student Details</h3>
      <p id="student-detail-name" class="text-[var(--text)] mb-2"></p>
      <p id="student-detail-subjects" class="text-[var(--text)] mb-2"></p>
      <p id="student-detail-session" class="text-[var(--text)] mb-4"></p>
      <h4 class="text-lg font-semibold mb-2 text-[var(--heading)]">Overall Progress</h4>
      <div class="relative w-24 h-24 progress-circle mb-4">
        <svg class="w-full h-full">
          <circle cx="50%" cy="50%" r="45%" stroke="#e5e7eb" stroke-width="8" fill="none"/>
          <circle id="detail-progress-arc" cx="50%" cy="50%" r="45%" stroke="#3B82F6" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="0"/>
        </svg>
        <div class="absolute inset-0 flex items-center justify-center font-bold text-lg text-[var(--text)]" id="detail-progress-label">0%</div>
      </div>
      <h4 class="text-lg font-semibold mb-2 text-[var(--heading)]">Detailed Progress</h4>
      <div class="mb-4">
        <div class="mb-2">
          <span>Math: <span id="detail-subj-math">0%</span></span>
          <div class="bg-gray-200 h-2 rounded">
            <div id="detail-bar-math" class="bg-blue-600 h-2 rounded" style="width:0%"></div>
          </div>
        </div>
        <div class="mb-2">
          <span>Physics: <span id="detail-subj-physics">0%</span></span>
          <div class="bg-gray-200 h-2 rounded">
            <div id="detail-bar-physics" class="bg-green-600 h-2 rounded" style="width:0%"></div>
          </div>
        </div>
      </div>
      <h4 class="text-lg font-semibold mb-2 text-[var(--heading)]">Session History</h4>
      <table id="student-session-history" class="w-full text-left mb-4">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">Date</th>
            <th class="p-2">Time</th>
            <th class="p-2">Subjects</th>
            <th class="p-2">Cost</th>
            <th class="p-2">Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="flex gap-2">
        <button onclick="closeStudentDetailsModal()" class="bg-gray-700 text-white px-4 py-2 rounded-lg flex-1 hover:bg-gray-800">Close</button>
        <button onclick="openChatModal(document.getElementById('student-details-modal').dataset.studentId)" class="cta-button px-4 py-2 rounded-lg flex-1">Chat</button>
        <button onclick="openGoLiveModal(document.getElementById('student-details-modal').dataset.studentId)" class="bg-red-600 text-white px-4 py-2 rounded-lg flex-1 hover:bg-red-700">Go Live</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="edit-profile-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Edit Profile</h3>
      <label class="block mb-2 text-[var(--text)]">Name</label>
      <input type="text" id="profile-name" class="w-full p-2 border rounded-lg mb-4" value="Amanuel Tesfaye">
      <label class="block mb-2 text-[var(--text)]">Location</label>
      <div class="flex gap-2 mb-4">
        <input type="text" id="profile-location" class="w-full p-2 border rounded-lg" placeholder="Enter your location" readonly>
        <button id="use-my-location" onclick="getLocation()" class="cta-button px-4 py-2 rounded-lg">Use My Location</button>
      </div>
      <p id="location-error" class="text-red-500 text-sm mb-2 hidden">Unable to get location.</p>
      <label class="block mb-2 text-[var(--text)]">School</label>
      <input type="text" id="profile-school" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter school name">
      <p id="school-error" class="text-red-500 text-sm mb-2 hidden">Invalid school name. Please select a valid school.</p>
      <label class="block mb-2 text-[var(--text)]">ID Document (Passport, Driver‚Äôs License, FIDA, etc.)</label>
      <input type="file" id="id-input" accept="image/*,application/pdf" class="w-full p-2 border rounded-lg mb-2">
      <p id="id-error" class="text-red-500 text-sm mb-2 hidden">Invalid file (max 5MB, JPEG/PNG/GIF/PDF).</p>
      <div id="id-preview" class="mb-4"></div>
      <label class="block mb-2 text-[var(--text)]">Face Scan (Selfie via Webcam)</label>
      <button id="face-scan-btn" onclick="captureSelfie()" class="cta-button px-4 py-2 rounded-lg mb-2">Capture Selfie</button>
      <p id="face-scan-status" class="text-[var(--text)] mb-2">No selfie captured.</p>
      <label class="block mb-2 text-[var(--text)]">Payment Method</label>
      <select id="payment-method" class="w-full p-2 border rounded-lg mb-4">
        <option value="" disabled selected>Select a payment method</option>
        <option value="cbe">Commercial Bank of Ethiopia</option>
        <option value="awash">Awash Bank</option>
        <option value="dashen">Dashen Bank</option>
        <option value="telebirr">Telebirr</option>
      </select>
      <p id="payment-method-error" class="text-red-500 text-sm mb-2 hidden">Please select a payment method.</p>
      <label class="block mb-2 text-[var(--text)]">Payment Account Number</label>
      <input type="text" id="payment-account" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter account number">
      <p id="payment-account-error" class="text-red-500 text-sm mb-2 hidden">Invalid account number.</p>
      <label class="block mb-2 text-[var(--text)]">Profile Picture</label>
      <input type="file" id="profile-picture-input" accept="image/*" class="w-full p-2 border rounded-lg mb-2">
      <p id="profile-picture-error" class="text-red-500 text-sm mb-2 hidden">Invalid image file (max 5MB, JPEG/PNG/GIF).</p>
      <canvas id="profile-picture-preview" width="128" height="128" class="mb-4"></canvas>
      <label class="block mb-2 text-[var(--text)]">Cover Picture</label>
      <input type="file" id="cover-picture-input" accept="image/*" class="w-full p-2 border rounded-lg mb-2">
      <p id="cover-picture-error" class="text-red-500 text-sm mb-2 hidden">Invalid image file (max 5MB, JPEG/PNG/GIF).</p>
      <canvas id="cover-picture-preview" width="300" height="100" class="mb-4"></canvas>
      <label class="block mb-2 text-[var(--text)]">About Me</label>
      <textarea id="profile-about" class="w-full p-2 border rounded-lg mb-4" rows="4">Hi, I'm Amanuel, a passionate tutor with 5 years of experience in teaching Math and Physics. I focus on making complex concepts simple and engaging for students.</textarea>
      <label class="block mb-2 text-[var(--text)]">Courses (comma-separated, e.g., Algebra:hourly:350)</label>
      <div class="mb-4">
        <select id="fee-type" class="w-full p-2 border rounded-lg mb-2">
          <option value="hourly">Hourly Fee</option>
          <option value="monthly">Monthly Fee</option>
        </select>
        <input type="text" id="profile-courses" class="w-full p-2 border rounded-lg" value="Algebra:hourly:350,Geometry:hourly:350,Physics 101:hourly:400">
      </div>
      <label class="block mb-2 text-[var(--text)]">Certifications (one per line)</label>
      <textarea id="profile-certifications" class="w-full p-2 border rounded-lg mb-4" rows="4">BSc in Physics, Addis Ababa University, 2018
Teaching Certificate, Ethiopian Ministry of Education, 2019</textarea>
      <label class="block mb-2 text-[var(--text)]">Certification Documents</label>
      <input type="file" id="certification-documents-input" accept="image/*,application/pdf" multiple class="w-full p-2 border rounded-lg mb-2">
      <p id="certification-documents-error" class="text-red-500 text-sm mb-2 hidden">Invalid file(s) (max 5MB, JPEG/PNG/GIF/PDF).</p>
      <div id="certification-documents-preview" class="grid grid-cols-2 gap-4 mb-4"></div>
      <label class="block mb-2 text-[var(--text)]">Social Media Links</label>
      <input type="text" id="social-facebook" class="w-full p-2 border rounded-lg mb-4" placeholder="Facebook URL">
      <input type="text" id="social-twitter" class="w-full p-2 border rounded-lg mb-4" placeholder="Twitter URL">
      <input type="text" id="social-youtube" class="w-full p-2 border rounded-lg mb-4" placeholder="YouTube URL">
      <button onclick="submitProfileEdit()" class="cta-button px-4 py-2 rounded-lg w-full">Save Changes</button>
      <button onclick="closeEditProfileModal()" class="mt-4 text-[var(--text)] hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Upload Video Modal -->
  <div id="upload-video-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Upload Video</h3>
      <label class="block mb-2 text-[var(--text)]">Select Video</label>
      <select id="video-select" class="w-full p-2 border rounded-lg mb-4">
        <option value="intro">Introduction Video</option>
        <option value="clip1">Short Clip 1</option>
        <option value="clip2">Short Clip 2</option>
      </select>
      <label class="block mb-2 text-[var(--text)]">Video File</label>
      <input type="file" id="upload-video-input" accept="video/mp4" class="w-full p-2 border rounded-lg mb-2">
      <p id="upload-video-error" class="text-red-500 text-sm mb-2 hidden">Invalid video file (max 10MB, MP4).</p>
      <video id="upload-video-preview" controls class="w-full rounded-lg mb-2 preview"></video>
      <label class="block mb-2 text-[var(--text)]">Video Description</label>
      <textarea id="upload-video-desc-input" class="w-full p-2 border rounded-lg mb-4" rows="3"></textarea>
      <button onclick="submitVideoUpload()" class="cta-button px-4 py-2 rounded-lg w-full">Save Changes</button>
      <button onclick="closeUploadVideoModal()" class="mt-4 text-[var(--text)] hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Video Description Modal -->
  <div id="video-desc-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Edit Video Description</h3>
      <label class="block mb-2 text-[var(--text)]">Description</label>
      <textarea id="video-desc-input" class="w-full p-2 border rounded-lg mb-4" rows="4"></textarea>
      <button onclick="submitVideoDesc()" class="cta-button px-4 py-2 rounded-lg w-full">Save</button>
      <button onclick="closeVideoDescModal()" class="mt-4 text-[var(--text)] hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Modals -->
  <div id="comment-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Student Comments</h3>
      <div id="comments-list" class="text-[var(--text)]"></div>
      <button onclick="closeCommentModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Share Video</h3>
      <input type="hidden" id="share-url" value="">
      <div class="grid grid-cols-2 gap-4 mb-4">
        <a id="share-facebook" href="#" target="_blank" class="cta-button px-4 py-2 rounded-lg text-center">Facebook</a>
        <a id="share-instagram" href="#" target="_blank" class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 text-center">Instagram</a>
        <a id="share-youtube" href="#" target="_blank" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-center">YouTube</a>
        <a id="share-tiktok" href="#" target="_blank" class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 text-center">TikTok</a>
        <a id="share-telegram" href="#" target="_blank" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-center">Telegram</a>
        <button onclick="copyLink()" class="cta-button px-4 py-2 rounded-lg">Copy Link</button>
      </div>
      <button onclick="closeShareModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Referral Modal -->
  <div id="referral-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Share Your Referral Link</h3>
      <p class="text-[var(--text)] mb-4">Share your unique referral link to earn a 5% affiliate fee on registrations!</p>
      <p id="referral-code" class="text-[var(--text)] mb-2">Your Referral Code: <span id="referral-code-value">Not generated</span></p>
      <input type="text" id="referral-link" class="w-full p-2 border rounded-lg mb-4" readonly>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <a id="referral-share-facebook" href="#" target="_blank" class="cta-button px-4 py-2 rounded-lg text-center">Facebook</a>
        <a id="referral-share-telegram" href="#" target="_blank" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-center">Telegram</a>
        <button onclick="copyReferralLink()" class="cta-button px-4 py-2 rounded-lg">Copy Link</button>
      </div>
      <button onclick="closeReferralModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Students Modal -->
  <div id="students-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-4xl max-h-[80vh] overflow-y-auto relative">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">My Students</h3>
      <input type="text" id="student-search" class="w-full p-2 border rounded-lg mb-4" placeholder="Search students by name...">
      <div class="absolute top-6 right-6 w-24 h-24 progress-circle">
        <svg class="w-full h-full">
          <circle cx="50%" cy="50%" r="45%" stroke="#e5e7eb" stroke-width="8" fill="none"/>
          <circle id="overall-progress-arc" cx="50%" cy="50%" r="45%" stroke="#3B82F6" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="0"/>
        </svg>
        <div class="absolute inset-0 flex items-center justify-center font-bold text-lg text-[var(--text)]" id="overall-progress-label">0%</div>
        <div class="tooltip hidden top-full mt-2 w-48 bg-[var(--modal-bg)] p-3 rounded shadow-lg text-sm text-[var(--text)]">
          <div id="overall-student-progress"></div>
        </div>
      </div>
      <button onclick="openSessionSheetModal()" class="cta-button px-4 py-2 rounded-lg mb-4">View Session Sheet</button>
      <table class="w-full text-left">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">Student Name</th>
            <th class="p-2">Progress</th>
            <th class="p-2">Next Session</th>
            <th class="p-2">Details</th>
          </tr>
        </thead>
        <tbody id="student-table">
          <tr>
            <td class="p-2">Abebe Kebede</td>
            <td class="p-2">
              <div class="relative inline-block progress-circle">
                <svg class="w-12 h-12">
                  <circle cx="50%" cy="50%" r="45%" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                  <circle class="student-progress-arc" cx="50%" cy="50%" r="45%" stroke="#3B82F6" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="141.5"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center font-bold text-sm text-[var(--text)]">50%</div>
                <div class="tooltip hidden top-full mt-2 w-48 bg-[var(--modal-bg)] p-3 rounded shadow-lg text-sm text-[var(--text)]">
                  <div class="mb-1">Math: <span>60%</span></div>
                  <div class="bg-gray-200 h-2 rounded mb-2">
                    <div class="bg-blue-600 h-2 rounded" style="width:60%"></div>
                  </div>
                  <div class="mb-1">Physics: <span>40%</span></div>
                  <div class="bg-gray-200 h-2 rounded">
                    <div class="bg-green-600 h-2 rounded" style="width:40%"></div>
                  </div>
                </div>
              </div>
            </td>
            <td class="p-2">May 20, 2025, 2:00 PM</td>
            <td class="p-2">
              <button onclick="openStudentDetailsModal(1)" class="cta-button px-2 py-1 rounded">View</button>
            </td>
          </tr>
        </tbody>
      </table>
      <button onclick="closeStudentsModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Session Sheet Modal -->
  <div id="session-sheet-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-4xl max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Session Sheet</h3>
      <table class="w-full text-left">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">Date</th>
            <th class="p-2">Time</th>
            <th class="p-2">Duration</th>
            <th class="p-2">Student</th>
            <th class="p-2">Subjects</th>
            <th class="p-2">Cost</th>
            <th class="p-2">Status</th>
            <th class="p-2">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="p-2">May 20, 2025</td>
            <td class="p-2">2:00 PM</td>
            <td class="p-2">80 min</td>
            <td class="p-2">Abebe Kebede</td>
            <td class="p-2">Math, Physics</td>
            <td class="p-2">1000 birr</td>
            <td class="p-2" id="session-1-status">Scheduled</td>
            <td class="p-2">
              <button id="session-1-confirm" onclick="confirmAttendance(1, 'tutor')" class="cta-button px-2 py-1 rounded">Confirm Attendance</button>
              <button id="session-1-wait" onclick="confirmWaiting(1, 'tutor')" class="bg-yellow-600 text-white px-2 py-1 rounded hover:bg-yellow-700 hidden">Confirm Waiting</button>
              <button id="session-1-makeup" onclick="proposeMakeup(1)" class="cta-button px-2 py-1 rounded hidden">Propose Makeup</button>
              <button id="session-1-subjects" onclick="openSubjectsModal(1)" class="cta-button px-2 py-1 rounded">Edit Subjects</button>
            </td>
          </tr>
        </tbody>
      </table>
      <button onclick="closeSessionSheetModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Subjects Modal -->
  <div id="subjects-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Edit Session Subjects</h3>
      <label class="block mb-2 text-[var(--text)]">Select Subjects</label>
      <div class="mb-4">
        <label class="block"><input type="checkbox" id="subject-Math" value="Math"> Math</label>
        <label class="block"><input type="checkbox" id="subject-Physics" value="Physics"> Physics</label>
      </div>
      <button onclick="submitSubjects()" class="cta-button px-4 py-2 rounded-lg w-full">Save</button>
      <button onclick="closeSubjectsModal()" class="mt-4 text-[var(--text)] hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Makeup Session Modal -->
  <div id="makeup-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Propose Makeup Session</h3>
      <label class="block mb-2 text-[var(--text)]">Date</label>
      <input type="date" id="makeup-date" class="w-full p-2 border rounded-lg mb-4">
      <label class="block mb-2 text-[var(--text)]">Time</label>
      <input type="time" id="makeup-time" step="300" class="w-full p-2 border rounded-lg mb-4">
      <button onclick="submitMakeup()" class="cta-button px-4 py-2 rounded-lg w-full">Propose</button>
      <button onclick="closeMakeupModal()" class="mt-4 text-[var(--text)] hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Notification Modal -->
  <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Notifications</h3>
      <div id="notification-content" class="text-[var(--text)]">You have no notifications.</div>
      <button onclick="closeNotificationModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Chat Modal -->
  <div id="chat-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto flex flex-col">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]" id="chat-student-name">Chat</h3>
      <div id="chat-messages" class="flex-1 overflow-y-auto mb-4 p-4 bg-gray-100 rounded-lg"></div>
      <div class="flex gap-2">
        <input type="text" id="chat-input" class="flex-1 p-2 border rounded-lg" placeholder="Type your message...">
        <button onclick="sendMessage()" class="cta-button px-4 py-2 rounded-lg">Send</button>
      </div>
      <button onclick="closeChatModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Go Live Modal -->
  <div id="go-live-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
    <div class="modal-content p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Go Live</h3>
      <p class="text-[var(--text)]">Go Live functionality to be implemented.</p>
      <button onclick="closeGoLiveModal()" class="mt-4 text-[var(--text)] hover:underline">Close</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-8">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="text-center md:text-left">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--heading);">Quick Links</h3>
          <ul class="space-y-2">
            <li><a class="nav-link hover:underline" href="index.html">Home</a></li>
            <li><a class="nav-link hover:underline" href="#contact">Contact Us</a></li>
            <li><button class="nav-link hover:underline bg-transparent border-none p-0" onclick="openLoginRegisterModal()">Login/Register</button></li>
            <li><button class="nav-link hover:underline bg-transparent border-none p-0" onclick="openAdvertiseModal()">Advertise</button></li>
          </ul>
        </div>
        <div class="text-center md:text-left">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--heading);">Newsletter</h3>
          <p class="mb-4">Stay updated with our latest news and offers.</p>
          <div class="mt-4 flex flex-col items-center md:items-start">
            <input class="w-full max-w-xs p-2 border rounded-lg mb-4" placeholder="Enter your email" type="email"/>
            <button class="cta-button px-4 py-2 rounded-lg w-full max-w-xs">Subscribe</button>
          </div>
        </div>
        <div class="text-center md:text-left">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--heading);">Get in Touch</h3>
          <p class="mb-2">Email: <a class="nav-link hover:underline" href="mailto:info@astegni.et">info@astegni.et</a></p>
          <p class="mb-4">Phone: +251-912-345-678</p>
          <div class="flex justify-center md:justify-start gap-4">
            <a class="social-icon" href="https://facebook.com">
              <svg class="w-6 h-6" fill="var(--footer-text)" viewBox="0 0 24 24">
                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"></path>
              </svg>
            </a>
            <a class="social-icon" href="https://x.com">
              <svg class="w-6 h-6" fill="var(--footer-text)" viewBox="0 0 24 24">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
              </svg>
            </a>
            <a class="social-icon" href="https://instagram.com">
              <svg class="w-6 h-6" fill="var(--footer-text)" viewBox="0 0 24 24">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.148 3.227-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.148-4.771-1.691-4.919-4.919-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.332.014 7.052.072 2.951.227.228 2.996.073 7.052.014 8.332 0 8.741 0 12c0 3.259.014 3.668.072 4.948.225 4.053 2.992 6.776 7.048 6.931 1.28.058 1.689.072 4.948.072s3.668-.014 4.948-.072c4.056-.155 6.824-2.878 6.979-6.931.058-1.28.072-1.689.072-4.948s-.014-3.668-.072-4.948c-.155-4.053-2.923-6.776-6.979-6.931C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a3.999 3.999 0 110-7.998 3.999 3.999 0 010 7.998zm6.406-11.845a1.44 1.44 0 11-2.88 0 1.44 1.44 0 012.88 0z"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
      <div class="mt-8 text-center">
        <p class="mb-2">Join us with only 500 birr registration fee and 200 birr/month</p>
        <p>¬© 2025 Astegni. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    let isLoggedIn = true;
    let currentSessionId = null;
    let currentVideoKey = null;
    let currentStudentId = null;

    const students = {
      1: {
        name: 'Abebe Kebede',
        progress: { cumulative: 50, math: 60, physics: 40 },
        nextSession: 'May 20, 2025, 2:00 PM'
      }
    };

    const tutor = {
      name: 'Amanuel Tesfaye',
      rating: 1.0,
      about: "Hi, I'm Amanuel, a passionate tutor with 5 years of experience in teaching Math and Physics. I focus on making complex concepts simple and engaging for students.",
      address: '',
      school: '',
      paymentMethod: '',
      paymentAccount: '',
      paymentVerified: false,
      referralCode: null,
      courses: [
        { name: 'Algebra', feeType: 'hourly', rate: 350 },
        { name: 'Geometry', feeType: 'hourly', rate: 350 },
        { name: 'Physics 101', feeType: 'hourly', rate: 400 }
      ],
      certifications: ['BSc in Physics, Addis Ababa University, 2018', 'Teaching Certificate, Ethiopian Ministry of Education, 2019'],
      certificationDocuments: [],
      socialMedia: { facebook: '', twitter: '', youtube: '' },
      idFile: null,
      selfieCaptured: false,
      verified: false,
      profilePicture: 'https://via.placeholder.com/64',
      coverPicture: 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=150&q=80',
      videos: {
        intro: { src: 'https://via.placeholder.com/640x360.mp4', desc: 'Introduction to my teaching style.', comments: [] },
        clip1: { src: 'https://via.placeholder.com/320x180.mp4', desc: 'Quick Math tip.', comments: [] },
        clip2: { src: 'https://via.placeholder.com/320x180.mp4', desc: 'Physics concept explained.', comments: [] }
      },
      comments: [
    { author: 'Abebe Kebede', text: 'Amanuel explains complex topics clearly!', date: '2025-05-20' },
    { author: 'Selam Yohannes', text: 'Great tutor, very patient and knowledgeable.', date: '2025-05-22' }
  ]
    };

    const sessions = {
      1: {
        date: '2025-05-20',
        time: '14:00',
        duration: '80 minutes',
        student: 1,
        subjects: ['Math', 'Physics'],
        cost: 1000,
        status: 'Scheduled',
        studentConfirmed: false,
        tutorConfirmed: false,
        waiting: { student: false, tutor: false },
        makeup: null
      }
    };

    const chatMessages = {
      1: [
        { sender: 'You', message: 'Hi Abebe, how‚Äôs your Math prep going?', timestamp: '2025-05-20 13:00' },
        { sender: 'Abebe Kebede', message: 'It‚Äôs going well, thanks! Need help with algebra.', timestamp: '2025-05-20 13:05' }
      ]
    };

    const schoolDatabase = [
      'Addis Ababa University',
      'Menelik II School',
      'St. Joseph School',
      'Ethiopian International School',
      'Lycee Guebre-Mariam'
    ];

    // Utility function to sanitize input
    function sanitizeInput(input) {
      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML;
    }

    // Theme Management
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    function initializeTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
    }

    // Navigation
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('mobile-theme-toggle').addEventListener('click', toggleTheme);

    function updateNavigation() {
      const notificationBell = document.getElementById('notification-bell');
      const mobileNotificationBell = document.getElementById('mobile-notification-bell');
      if (isLoggedIn) {
        notificationBell.classList.remove('hidden');
        mobileNotificationBell.classList.remove('hidden');
      } else {
        notificationBell.classList.add('hidden');
        mobileNotificationBell.classList.add('hidden');
      }
    }

    // Verification Functions
    function verifyTutor(tutor) {
      const { name, idFile, selfieCaptured, paymentMethod, paymentAccount, school, certifications } = tutor;
      return (
        name && name.trim().length >= 2 &&
        idFile &&
        selfieCaptured &&
        paymentMethod &&
        paymentAccount &&
        verifyPayment(paymentMethod, paymentAccount) &&
        school && validateSchool(school) &&
        certifications && certifications.length > 0
      );
    }

    function verifyPayment(paymentMethod, paymentAccount) {
      if (!paymentMethod || !paymentAccount) return false;
      // Simulate payment verification (e.g., check format or external API call)
      const accountRegex = /^\d{10,16}$/; // Example: 10-16 digit account number
      const isValidAccount = accountRegex.test(paymentAccount);
      // Simulate API call to payment gateway (mocked for now)
      return isValidAccount; // Assume success if format is valid
    }

    function captureSelfie() {
      tutor.selfieCaptured = true;
      document.getElementById('face-scan-status').textContent = 'Selfie captured successfully.';
      document.getElementById('face-scan-status').className = 'text-green-600 mb-2';
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            tutor.address = `Lat:${latitude.toFixed(4)},Lon:${longitude.toFixed(4)}`;
            document.getElementById('profile-location').value = tutor.address;
            document.getElementById('location-error').classList.add('hidden');
          },
          () => {
            document.getElementById('location-error').classList.remove('hidden');
          }
        );
      } else {
        document.getElementById('location-error').classList.remove('hidden');
      }
    }

    function validateSchool(school) {
      return schoolDatabase.includes(school.trim());
    }

    function generateReferralCode() {
      if (!tutor.referralCode) {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        tutor.referralCode = Array.from({ length: 8 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
      }
      return tutor.referralCode;
    }

    function updateRatingCircle() {
      const rating = tutor.rating;
      const percent = (rating / 5) * 100;
      const ratingArc = document.getElementById('rating-arc');
      let color;
      if (rating > 4) {
        color = '#10B981'; // Green
      } else if (rating > 3) {
        color = '#FBBF24'; // Yellow
      } else if (rating > 2) {
        color = '#EF4444'; // Red
      } else if (rating > 1) {
        color = '#3B82F6'; // Blue
      } else {
        color = '#6B7280'; // Gray
      }
      ratingArc.setAttribute('stroke', color);
      const circumference = 2 * Math.PI * 45;
      ratingArc.setAttribute('stroke-dasharray', circumference);
      ratingArc.setAttribute('stroke-dashoffset', circumference * (1 - percent / 100));
      document.getElementById('rating-label').textContent = rating > 0 ? `${rating.toFixed(1)}/5` : 'N/A';
      const stars = rating > 0 ? '‚òÖ'.repeat(Math.round(rating)) + '‚òÜ'.repeat(5 - Math.round(rating)) : 'No rating';
      document.getElementById('tutor-rating-stars').textContent = stars;
    }

    function updateVerificationStatus() {
      const verified = tutor.verified;
      const paymentVerified = tutor.paymentVerified;
      const statusEl = document.getElementById('verification-status');
      statusEl.textContent = verified ? 'Verified' : paymentVerified ? 'Payment Verified' : 'Unverified';
      statusEl.className = verified ? 'text-green-500 italic mb-2' : paymentVerified ? 'text-blue-500 italic mb-2' : 'text-red-500 italic mb-2';
    }

    function previewId() {
      const input = document.getElementById('id-input');
      const preview = document.getElementById('id-preview');
      const error = document.getElementById('id-error');
      preview.innerHTML = '';
      error.classList.add('hidden');
      const file = input.files[0];
      if (!file) return;
      const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
      const maxSize = 5 * 1024 * 1024;
      if (!validTypes.includes(file.type) || file.size > maxSize) {
        error.classList.remove('hidden');
        input.value = '';
        return;
      }
      const div = document.createElement('div');
      if (file.type === 'application/pdf') {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(file);
        a.target = '_blank';
        a.textContent = file.name;
        a.className = 'text-blue-600 underline';
        div.appendChild(a);
      } else {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        img.alt = file.name;
        img.className = 'w-32 h-32 object-cover rounded-lg';
        div.appendChild(img);
        const p = document.createElement('p');
        p.textContent = file.name;
        p.className = 'text-sm text-[var(--text)] mt-1 truncate';
        div.appendChild(p);
      }
      preview.appendChild(div);
    }

    function previewImage(inputId, canvasId, errorId, width, height) {
      const input = document.getElementById(inputId);
      const canvas = document.getElementById(canvasId);
      const error = document.getElementById(errorId);
      error.classList.add('hidden');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const file = input.files[0];
      if (!file) return;
      const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
      const maxSize = 5 * 1024 * 1024;
      if (!validTypes.includes(file.type) || file.size > maxSize) {
        error.classList.remove('hidden');
        input.value = '';
        return;
      }
      const img = new Image();
      img.onload = () => ctx.drawImage(img, 0, 0, width, height);
      img.src = URL.createObjectURL(file);
    }

    function previewVideo() {
      const input = document.getElementById('upload-video-input');
      const preview = document.getElementById('upload-video-preview');
      const error = document.getElementById('upload-video-error');
      error.classList.add('hidden');
      preview.src = '';
      const file = input.files[0];
      if (!file) return;
      const validTypes = ['video/mp4'];
      const maxSize = 10 * 1024 * 1024;
      if (!validTypes.includes(file.type) || file.size > maxSize) {
        error.classList.remove('hidden');
        input.value = '';
        return;
      }
      preview.src = URL.createObjectURL(file);
    }

    function previewDocuments() {
      const input = document.getElementById('certification-documents-input');
      const preview = document.getElementById('certification-documents-preview');
      const error = document.getElementById('certification-documents-error');
      preview.innerHTML = '';
      error.classList.add('hidden');
      const files = Array.from(input.files);
      const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
      const maxSize = 5 * 1024 * 1024;
      files.forEach(file => {
        if (!validTypes.includes(file.type) || file.size > maxSize) {
          error.classList.remove('hidden');
          return;
        }
        const div = document.createElement('div');
        if (file.type === 'application/pdf') {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(file);
          a.target = '_blank';
          a.textContent = file.name;
          a.className = 'text-blue-600 underline';
          div.appendChild(a);
        } else {
          const canvas = document.createElement('canvas');
          canvas.width = 128;
          canvas.height = 128;
          canvas.className = 'border rounded-lg';
          const img = new Image();
          img.onload = () => canvas.getContext('2d').drawImage(img, 0, 0, 128, 128);
          img.src = URL.createObjectURL(file);
          div.appendChild(canvas);
          const p = document.createElement('p');
          p.textContent = file.name;
          p.className = 'text-sm text-[var(--text)] mt-1 truncate';
          div.appendChild(p);
        }
        preview.appendChild(div);
      });
    }

function openReferralModal() {
  document.getElementById('referral-modal').classList.remove('hidden');
  const referralCode = generateReferralCode();
  document.getElementById('referral-code-value').textContent = referralCode;
  const referralLink = `https://astegni.et/referral/${referralCode}`;
  document.getElementById('referral-link').value = referralLink;
  document.getElementById('referral-share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}`;
  document.getElementById('referral-share-telegram').href = `https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=Join%20ASTEGNI%20with%20my%20referral%20code!`;
}

function copyReferralLink() {
  const referralLink = document.getElementById('referral-link');
  referralLink.select();
  document.execCommand('copy');
  alert('Referral link copied to clipboard!');
}

function closeReferralModal() {
  document.getElementById('referral-modal').classList.add('hidden');
}

function openEditProfileModal() {
  document.getElementById('edit-profile-modal').classList.remove('hidden');
  document.getElementById('profile-name').value = tutor.name;
  document.getElementById('profile-location').value = tutor.address;
  document.getElementById('profile-school').value = tutor.school;
  document.getElementById('payment-method').value = tutor.paymentMethod || '';
  document.getElementById('payment-account').value = tutor.paymentAccount || '';
  document.getElementById('profile-about').value = tutor.about;
  document.getElementById('profile-courses').value = tutor.courses.map(c => `${c.name}:${c.feeType}:${c.rate}`).join(',');
  document.getElementById('profile-certifications').value = tutor.certifications.join('\n');
  document.getElementById('social-facebook').value = tutor.socialMedia.facebook;
  document.getElementById('social-twitter').value = tutor.socialMedia.twitter;
  document.getElementById('social-youtube').value = tutor.socialMedia.youtube;
}

function closeEditProfileModal() {
  document.getElementById('edit-profile-modal').classList.add('hidden');
  resetEditProfileForm();
}

function resetEditProfileForm() {
  document.getElementById('id-input').value = '';
  document.getElementById('id-preview').innerHTML = '';
  document.getElementById('id-error').classList.add('hidden');
  document.getElementById('profile-picture-input').value = '';
  document.getElementById('profile-picture-error').classList.add('hidden');
  document.getElementById('cover-picture-input').value = '';
  document.getElementById('cover-picture-error').classList.add('hidden');
  document.getElementById('certification-documents-input').value = '';
  document.getElementById('certification-documents-preview').innerHTML = '';
  document.getElementById('certification-documents-error').classList.add('hidden');
  document.getElementById('school-error').classList.add('hidden');
  document.getElementById('payment-method-error').classList.add('hidden');
  document.getElementById('payment-account-error').classList.add('hidden');
}

function submitProfileEdit() {
  const name = sanitizeInput(document.getElementById('profile-name').value);
  const address = sanitizeInput(document.getElementById('profile-location').value);
  const school = sanitizeInput(document.getElementById('profile-school').value);
  const paymentMethod = document.getElementById('payment-method').value;
  const paymentAccount = sanitizeInput(document.getElementById('payment-account').value);
  const about = sanitizeInput(document.getElementById('profile-about').value);
  const coursesInput = sanitizeInput(document.getElementById('profile-courses').value);
  const certifications = document.getElementById('profile-certifications').value.split('\n').map(s => sanitizeInput(s.trim())).filter(s => s);
  const idFile = document.getElementById('id-input').files[0];
  const profilePicture = document.getElementById('profile-picture-input').files[0];
  const coverPicture = document.getElementById('cover-picture-input').files[0];
  const certificationDocuments = Array.from(document.getElementById('certification-documents-input').files);
  const socialFacebook = sanitizeInput(document.getElementById('social-facebook').value);
  const socialTwitter = sanitizeInput(document.getElementById('social-twitter').value);
  const socialYoutube = sanitizeInput(document.getElementById('social-youtube').value);

  // Validate inputs
  if (!name || name.length < 2) {
    alert('Name must be at least 2 characters long.');
    return;
  }
  if (!validateSchool(school)) {
    document.getElementById('school-error').classList.remove('hidden');
    return;
  }
  if (!paymentMethod) {
    document.getElementById('payment-method-error').classList.remove('hidden');
    return;
  }
  if (!/^\d{10,16}$/.test(paymentAccount)) {
    document.getElementById('payment-account-error').classList.remove('hidden');
    return;
  }

  // Update tutor object
  tutor.name = name;
  tutor.address = address;
  tutor.school = school;
  tutor.paymentMethod = paymentMethod;
  tutor.paymentAccount = paymentAccount;
  tutor.paymentVerified = verifyPayment(paymentMethod, paymentAccount);
  tutor.about = about;
  tutor.courses = coursesInput.split(',').map(c => {
    const [name, feeType, rate] = c.split(':');
    return { name: sanitizeInput(name), feeType, rate: parseFloat(rate) };
  }).filter(c => c.name && c.feeType && !isNaN(c.rate));
  tutor.certifications = certifications;
  tutor.socialMedia = { facebook: socialFacebook, twitter: socialTwitter, youtube: socialYoutube };
  if (idFile) tutor.idFile = idFile;
  if (profilePicture) tutor.profilePicture = URL.createObjectURL(profilePicture);
  if (coverPicture) tutor.coverPicture = URL.createObjectURL(coverPicture);
  if (certificationDocuments.length) tutor.certificationDocuments = certificationDocuments;
  tutor.verified = verifyTutor(tutor);

  updateProfileUI();
  updateVerificationStatus();
  closeEditProfileModal();
}

function updateProfileUI() {
  document.getElementById('tutor-name').childNodes[0].textContent = tutor.name;
  document.getElementById('tutor-gender').textContent = tutor.gender || 'Not specified';
  document.getElementById('tutor-address').textContent = `Address: ${tutor.address || 'Not set'}`;
  document.getElementById('tutor-school').textContent = `Teaches: ${tutor.school || 'Not set'}`;
  document.getElementById('courses').textContent = `Courses: ${tutor.courses.map(c => `${c.name} (${c.feeType}: ${c.rate} birr)`).join(', ') || 'Not set'}`;
  document.getElementById('course-fee').textContent = `Fee: ${tutor.courses.length ? tutor.courses.map(c => `${c.rate} birr/${c.feeType}`).join(', ') : 'Not set'}`;
  document.getElementById('payment-method').textContent = `Payment Method: ${tutor.paymentMethod || 'Not set'}`;
  document.getElementById('tutor-bio').textContent = tutor.about || 'No bio available.';
  document.getElementById('tutor-certifications').innerHTML = tutor.certifications.join('<br>') || 'No certifications listed.';
  document.getElementById('profile-picture').src = tutor.profilePicture;
  document.getElementById('cover-photo').style.backgroundImage = `url(${tutor.coverPicture})`;
  document.getElementById('social-facebook').href = tutor.socialMedia.facebook || '#';
  document.getElementById('social-twitter').href = tutor.socialMedia.twitter || '#';
  document.getElementById('social-linkedin').href = tutor.socialMedia.youtube || '#';
}

function openUploadVideoModal() {
  document.getElementById('upload-video-modal').classList.remove('hidden');
  document.getElementById('upload-video-input').value = '';
  document.getElementById('upload-video-preview').src = '';
  document.getElementById('upload-video-error').classList.add('hidden');
}

function closeUploadVideoModal() {
  document.getElementById('upload-video-modal').classList.add('hidden');
}

function submitVideoUpload() {
  const videoSelect = document.getElementById('video-select').value;
  const videoFile = document.getElementById('upload-video-input').files[0];
  const desc = sanitizeInput(document.getElementById('upload-video-desc-input').value);
  if (!videoFile) {
    document.getElementById('upload-video-error').classList.remove('hidden');
    return;
  }
  const validTypes = ['video/mp4'];
  const maxSize = 10 * 1024 * 1024;
  if (!validTypes.includes(videoFile.type) || videoFile.size > maxSize) {
    document.getElementById('upload-video-error').classList.remove('hidden');
    return;
  }
  tutor.videos[videoSelect].src = URL.createObjectURL(videoFile);
  tutor.videos[videoSelect].desc = desc;
  document.getElementById(videoSelect).querySelector('source').src = tutor.videos[videoSelect].src;
  document.getElementById(videoSelect).load();
  document.getElementById(`${videoSelect}-desc`).textContent = desc;
  closeUploadVideoModal();
}

function openVideoDescModal(videoKey) {
  currentVideoKey = videoKey;
  document.getElementById('video-desc-modal').classList.remove('hidden');
  document.getElementById('video-desc-input').value = tutor.videos[videoKey].desc;
}

function closeVideoDescModal() {
  document.getElementById('video-desc-modal').classList.add('hidden');
  currentVideoKey = null;
}

function submitVideoDesc() {
  if (currentVideoKey) {
    const desc = sanitizeInput(document.getElementById('video-desc-input').value);
    tutor.videos[currentVideoKey].desc = desc;
    document.getElementById(`${currentVideoKey}-desc`).textContent = desc;
  }
  closeVideoDescModal();
}

    function openCommentModal() {
      const commentsList = document.getElementById('comments-list');
      commentsList.innerHTML = tutor.comments?.length ? tutor.comments.map(comment => `
        <div class="mb-2">
          <p class="font-semibold text-[var(--text)]">${sanitizeInput(comment.author)}</p>
          <p class="text-[var(--text)]">${sanitizeInput(comment.text)}</p>
          <p class="text-sm text-gray-500">${comment.date}</p>
        </div>
      `).join('') : '<p class="text-[var(--text)]">No comments yet. Be the first to leave a review!</p>';
      document.getElementById('comment-modal').classList.remove('hidden');
    }

function closeCommentModal() {
  document.getElementById('comment-modal').classList.add('hidden');
}

function submitComment() {
  const comment = sanitizeInput(document.getElementById('comment-input').value);
  if (comment) {
    alert('Comment submitted: ' + comment); // Replace with actual comment submission logic
    closeCommentModal();
  } else {
    alert('Please enter a comment.');
  }
}

function openVideoCommentModal(videoKey) {
  currentVideoKey = videoKey;
  document.getElementById('comment-modal').classList.remove('hidden');
  document.getElementById('comment-input').value = '';
}

function openShareModal(videoKey) {
  currentVideoKey = videoKey;
  document.getElementById('share-modal').classList.remove('hidden');
  const videoUrl = tutor.videos[videoKey].src;
  document.getElementById('share-url').value = videoUrl;
  document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(videoUrl)}`;
  document.getElementById('share-instagram').href = `https://www.instagram.com/?url=${encodeURIComponent(videoUrl)}`;
  document.getElementById('share-youtube').href = `https://www.youtube.com/share?url=${encodeURIComponent(videoUrl)}`;
  document.getElementById('share-tiktok').href = `https://www.tiktok.com/share?url=${encodeURIComponent(videoUrl)}`;
  document.getElementById('share-telegram').href = `https://t.me/share/url?url=${encodeURIComponent(videoUrl)}&text=Check%20out%20this%20video!`;
}

function closeShareModal() {
  document.getElementById('share-modal').classList.add('hidden');
  currentVideoKey = null;
}

function copyLink() {
  const shareUrl = document.getElementById('share-url');
  shareUrl.select();
  document.execCommand('copy');
  alert('Link copied to clipboard!');
}

function openStudentsModal() {
  document.getElementById('students-modal').classList.remove('hidden');
  updateStudentsTable();
}

function closeStudentsModal() {
  document.getElementById('students-modal').classList.add('hidden');
}

function updateStudentsTable() {
  const tableBody = document.getElementById('student-table');
  tableBody.innerHTML = '';
  Object.entries(students).forEach(([id, student]) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="p-2">${student.name}</td>
      <td class="p-2">
        <div class="relative inline-block progress-circle">
          <svg class="w-12 h-12">
            <circle cx="50%" cy="50%" r="45%" stroke="#e5e7eb" stroke-width="8" fill="none"/>
            <circle class="student-progress-arc" cx="50%" cy="50%" r="45%" stroke="#3B82F6" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="${283 * (1 - student.progress.cumulative / 100)}"/>
          </svg>
          <div class="absolute inset-0 flex items-center justify-center font-bold text-sm text-[var(--text)]">${student.progress.cumulative}%</div>
          <div class="tooltip hidden top-full mt-2 w-48 bg-[var(--modal-bg)] p-3 rounded shadow-lg text-sm text-[var(--text)]">
            <div class="mb-1">Math: <span>${student.progress.math}%</span></div>
            <div class="bg-gray-200 h-2 rounded mb-2">
              <div class="bg-blue-600 h-2 rounded" style="width:${student.progress.math}%"></div>
            </div>
            <div class="mb-1">Physics: <span>${student.progress.physics}%</span></div>
            <div class="bg-gray-200 h-2 rounded">
              <div class="bg-green-600 h-2 rounded" style="width:${student.progress.physics}%"></div>
            </div>
          </div>
        </div>
      </td>
      <td class="p-2">${student.nextSession}</td>
      <td class="p-2">
        <button onclick="openStudentDetailsModal(${id})" class="cta-button px-2 py-1 rounded">View</button>
      </td>
    `;
    tableBody.appendChild(row);
  });

  const overallProgress = Object.values(students).reduce((sum, s) => sum + s.progress.cumulative, 0) / Object.keys(students).length;
  const overallArc = document.getElementById('overall-progress-arc');
  const circumference = 283;
  overallArc.setAttribute('stroke-dashoffset', circumference * (1 - overallProgress / 100));
  document.getElementById('overall-progress-label').textContent = `${Math.round(overallProgress)}%`;
  const overallTooltip = document.getElementById('overall-student-progress');
  const avgMath = Object.values(students).reduce((sum, s) => sum + s.progress.math, 0) / Object.keys(students).length;
  const avgPhysics = Object.values(students).reduce((sum, s) => sum + s.progress.physics, 0) / Object.keys(students).length;
  overallTooltip.innerHTML = `
    <div class="mb-1">Math: <span>${Math.round(avgMath)}%</span></div>
    <div class="bg-gray-200 h-2 rounded mb-2">
      <div class="bg-blue-600 h-2 rounded" style="width:${avgMath}%"></div>
    </div>
    <div class="mb-1">Physics: <span>${Math.round(avgPhysics)}%</span></div>
    <div class="bg-gray-200 h-2 rounded">
      <div class="bg-green-600 h-2 rounded" style="width:${avgPhysics}%"></div>
    </div>
  `;
}

function openStudentDetailsModal(studentId) {
  currentStudentId = studentId;
  const student = students[studentId];
  document.getElementById('student-details-modal').dataset.studentId = studentId;
  document.getElementById('student-details-modal').classList.remove('hidden');
  document.getElementById('student-detail-name').textContent = `Name: ${student.name}`;
  document.getElementById('student-detail-subjects').textContent = `Subjects: Math, Physics`;
  document.getElementById('student-detail-session').textContent = `Next Session: ${student.nextSession}`;
  const progressArc = document.getElementById('detail-progress-arc');
  const circumference = 283;
  progressArc.setAttribute('stroke-dashoffset', circumference * (1 - student.progress.cumulative / 100));
  document.getElementById('detail-progress-label').textContent = `${student.progress.cumulative}%`;
  document.getElementById('detail-subj-math').textContent = `${student.progress.math}%`;
  document.getElementById('detail-bar-math').style.width = `${student.progress.math}%`;
  document.getElementById('detail-subj-physics').textContent = `${student.progress.physics}%`;
  document.getElementById('detail-bar-physics').style.width = `${student.progress.physics}%`;
  const sessionHistory = document.getElementById('student-session-history').querySelector('tbody');
  sessionHistory.innerHTML = '';
  Object.entries(sessions).filter(([_, s]) => s.student == studentId).forEach(([id, session]) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="p-2">${session.date}</td>
      <td class="p-2">${session.time}</td>
      <td class="p-2">${session.subjects.join(', ')}</td>
      <td class="p-2">${session.cost} birr</td>
      <td class="p-2">${session.status}</td>
    `;
    sessionHistory.appendChild(row);
  });
}

function closeStudentDetailsModal() {
  document.getElementById('student-details-modal').classList.add('hidden');
  currentStudentId = null;
}

function openSessionSheetModal() {
  document.getElementById('session-sheet-modal').classList.remove('hidden');
}

function closeSessionSheetModal() {
  document.getElementById('session-sheet-modal').classList.add('hidden');
}

function openSubjectsModal(sessionId) {
  currentSessionId = sessionId;
  document.getElementById('subjects-modal').classList.remove('hidden');
  const session = sessions[sessionId];
  document.getElementById('subject-Math').checked = session.subjects.includes('Math');
  document.getElementById('subject-Physics').checked = session.subjects.includes('Physics');
}

function closeSubjectsModal() {
  document.getElementById('subjects-modal').classList.add('hidden');
  currentSessionId = null;
}

function submitSubjects() {
  if (currentSessionId) {
    const subjects = [];
    if (document.getElementById('subject-Math').checked) subjects.push('Math');
    if (document.getElementById('subject-Physics').checked) subjects.push('Physics');
    sessions[currentSessionId].subjects = subjects;
    alert('Subjects updated.');
    closeSubjectsModal();
  }
}

function confirmAttendance(sessionId, role) {
  sessions[sessionId][`${role}Confirmed`] = true;
  document.getElementById(`session-${sessionId}-status`).textContent = 'Confirmed';
  document.getElementById(`session-${sessionId}-confirm`).classList.add('hidden');
  document.getElementById(`session-${sessionId}-wait`).classList.remove('hidden');
  document.getElementById(`session-${sessionId}-makeup`).classList.remove('hidden');
}

function confirmWaiting(sessionId, role) {
  sessions[sessionId].waiting[role] = true;
  document.getElementById(`session-${sessionId}-status`).textContent = 'Waiting';
  document.getElementById(`session-${sessionId}-wait`).classList.add('hidden');
}

function proposeMakeup(sessionId) {
  currentSessionId = sessionId;
  document.getElementById('makeup-modal').classList.remove('hidden');
}

function closeMakeupModal() {
  document.getElementById('makeup-modal').classList.add('hidden');
  currentSessionId = null;
}

function submitMakeup() {
  if (currentSessionId) {
    const date = document.getElementById('makeup-date').value;
    const time = document.getElementById('makeup-time').value;
    if (date && time) {
      sessions[currentSessionId].makeup = { date, time };
      document.getElementById(`session-${currentSessionId}-status`).textContent = 'Makeup Proposed';
      alert('Makeup session proposed.');
      closeMakeupModal();
    } else {
      alert('Please select a date and time.');
    }
  }
}

function openNotificationModal() {
  document.getElementById('notification-modal').classList.remove('hidden');
}

function closeNotificationModal() {
  document.getElementById('notification-modal').classList.add('hidden');
}

function openChatModal(studentId) {
  currentStudentId = studentId || null;
  document.getElementById('chat-modal').classList.remove('hidden');
  if (studentId && students[studentId]) {
    document.getElementById('chat-student-name').textContent = `Chat with ${students[studentId].name}`;
    const messages = chatMessages[studentId] || [];
    const chatMessagesDiv = document.getElementById('chat-messages');
    chatMessagesDiv.innerHTML = messages.map(m => `
      <div class="mb-2 ${m.sender === 'You' ? 'text-right' : 'text-left'}">
        <p class="inline-block p-2 rounded-lg ${m.sender === 'You' ? 'bg-blue-100' : 'bg-gray-200'}">${m.message}</p>
        <p class="text-xs text-gray-500">${m.timestamp}</p>
      </div>
    `).join('');
    chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
  } else {
    document.getElementById('chat-student-name').textContent = 'Chat';
    document.getElementById('chat-messages').innerHTML = '<p>Select a student to chat.</p>';
  }
}

function closeChatModal() {
  document.getElementById('chat-modal').classList.add('hidden');
  currentStudentId = null;
}

function sendMessage() {
  const message = sanitizeInput(document.getElementById('chat-input').value);
  if (message && currentStudentId) {
    if (!chatMessages[currentStudentId]) chatMessages[currentStudentId] = [];
    const timestamp = new Date().toLocaleString();
    chatMessages[currentStudentId].push({ sender: 'You', message, timestamp });
    const chatMessagesDiv = document.getElementById('chat-messages');
    chatMessagesDiv.innerHTML += `
      <div class="mb-2 text-right">
        <p class="inline-block p-2 rounded-lg bg-blue-100">${message}</p>
        <p class="text-xs text-gray-500">${timestamp}</p>
      </div>
    `;
    chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
    document.getElementById('chat-input').value = '';
  } else {
    alert('Please enter a message and select a student.');
  }
}

function openGoLiveModal(studentId) {
  currentStudentId = studentId;
  document.getElementById('go-live-modal').classList.remove('hidden');
}

function closeGoLiveModal() {
  document.getElementById('go-live-modal').classList.add('hidden');
  currentStudentId = null;
}

function openLoginRegisterModal() {
  alert('Login/Register modal to be implemented.');
}

function openAdvertiseModal() {
  alert('Advertise modal to be implemented.');
}

// Event Listeners
document.getElementById('id-input').addEventListener('change', previewId);
document.getElementById('profile-picture-input').addEventListener('change', () => previewImage('profile-picture-input', 'profile-picture-preview', 'profile-picture-error', 128, 128));
document.getElementById('cover-picture-input').addEventListener('change', () => previewImage('cover-picture-input', 'cover-picture-preview', 'cover-picture-error', 300, 100));
document.getElementById('certification-documents-input').addEventListener('change', previewDocuments);
document.getElementById('upload-video-input').addEventListener('change', previewVideo);
document.getElementById('student-search').addEventListener('input', () => {
  const search = document.getElementById('student-search').value.toLowerCase();
  const rows = document.getElementById('student-table').querySelectorAll('tr');
  rows.forEach(row => {
    const name = row.cells[0].textContent.toLowerCase();
    row.style.display = name.includes(search) ? '' : 'none';
  });
});

// Initialize
initializeTheme();
updateNavigation();
updateProfileUI();
updateRatingCircle();
updateVerificationStatus();
  </script>
</body>
</html>